# Vimage AI Studio Frontend

An opinionated Vue 3/Vite frontend for the Vimage AI Studio experience. The app bundles media tooling, PrimeVue components, and audio/video workflows into a single dashboard that talks to a JSON API backend and an experimental FFmpeg/ComfyUI helper.

## Features
- **Authentication & profile management** with JWT-based session handling and guarded routes.
- **Media library** views for browsing, uploading, and editing video content (including vid2vid and Deforum editors).
- **Soundscape creator** that streams audio generated by the backend FFmpeg/ComfyUI pipeline.
- **Backend queue monitor** with `/api/status` and `/api/queue` endpoints to inspect processing and backlog health.
- **UI kit playground** powered by PrimeVue examples (tables, forms, dialogs, charts, overlays, menus, and more).
- **Developer utilities** for webcam capture, FFmpeg web transcoding, modal/video experiments, and Deforum UI previews.
- **Real-time Deforumation QT panel** for steering Deforum runs from the browser.
- **Responsive layout** built on PrimeFlex, PrimeIcons, and extensive PrimeVue component registration.

## Tech Stack
- [Vue 3](https://vuejs.org/) with [Vue Router](https://router.vuejs.org/) and [Vuex](https://vuex.vuejs.org/)
- [Vite](https://vitejs.dev/) dev/build tooling
- [PrimeVue](https://primevue.org/) + [PrimeFlex](https://primeflex.org/) + [PrimeIcons](https://primefaces.org/primeicons/)
- [Vue Plyr](https://github.com/redxtech/vue-plyr) and [vue-audio-visual](https://github.com/staskobzar/vue-audio-visual) for media playback
- Optional Node helper in `backend/` for streaming audio via FFmpeg and ComfyUI

## Getting Started
### Prerequisites
- Node.js **18+** and npm
- A running API server compatible with the routes used in `src/services`
- (Optional) Docker if you prefer containerized development

### Installation
1. Install dependencies:
   ```bash
   npm install
   ```
2. Create your environment file:
   ```bash
   cp .env.example .env
   ```
3. Set the URLs in `.env`:
   - `VUE_APP_BASE_URL`: public URL where the frontend is served (e.g. `http://localhost:8080/`).
   - `VUE_APP_APP_URL`: canonical public hostname for sharing links (e.g. `https://app.example.com`).
   - `VUE_APP_API_BASE_URL`: base URL of the JSON API (e.g. `http://localhost:3000/api/v1`).
   - `VUE_APP_API_V1_BASE_URL`: API v1 root (e.g. `http://localhost:3000/api/v1`).
   - `VUE_APP_STABLE_URL`: URL used by the Studio iframe (e.g. `https://stable.example.com`).
   - `VUE_APP_VIMAGE_API_URL`: profile/user service endpoint (e.g. `http://localhost:47860`).
   - `VUE_APP_FALLBACK_IMAGE_URL`: fallback image used across media listings.
   - `VUE_APP_SAMPLE_PROCESSED_VIDEO_URL`: sample processed video URL for the dev modal.

### Running the app
- Development server with debug logging:
  ```bash
  npm run dev
  ```
- Production build preview with Vite dev server:
  ```bash
  npm run serve
  ```
- Build static assets for deployment:
  ```bash
  npm run build
  ```
- Start the experimental audio helper (requires ComfyUI/FFmpeg):
  ```bash
  npm run api
  ```
- Run the backend/test suite for the helper API:
  ```bash
  npm test
  ```

### Docker workflow
1. Ensure Docker is running.
2. Bootstrap the full stack (frontend, helper API, Vimage API, MySQL, nginx, and FFmpeg workers):
   ```bash
   script/setup.sh --detach
   ```
   The script will copy `.env.docker.example` into `.env`/`.env.docker` on first run so the containers pick up matching hostnames
   inside the shared Docker network (`app.localhost`, `api.localhost`, `vimage-api.localhost`, and `gateway.localhost`).
3. The `ffmpeg-worker` service can be scaled to handle concurrent audio streams:
   ```bash
   docker compose up --build --scale ffmpeg-worker=6
   ```

## Project Structure
```
vimage-app/
├── src/
│   ├── assets/               # Global styles, fonts, and static media
│   ├── components/           # Reusable UI components
│   ├── layout/               # Shell layout and navigation
│   ├── pages/ & views/       # Route targets for dashboards, auth, media tools, etc.
│   ├── router/               # Route definitions and auth guards
│   ├── services/             # API client helpers
│   ├── store/                # Vuex store modules
│   └── main.js               # App bootstrap and PrimeVue registration
├── backend/                  # Optional FFmpeg/ComfyUI streaming helper
│   ├── app.js                # Express app exposing /api/stream, /api/status, /api/queue
│   ├── queueManager.js       # In-memory queue tracker for streaming requests
├── public/                   # Static assets served as-is
├── docker-compose.yml        # Container setup (frontend + workers)
└── README.md
```

## Backend helper API
- `GET /api/stream?text=`: stream generated AAC audio for the provided text prompt.
- `GET /api/status`: summarize current processing job, queue length, and recent history for quick health checks.
- `GET /api/queue`: list queued jobs, active processing entries, and the latest completed/failed work items.

## UI additions
- `/mage`: Mage helper dashboard that polls `/api/status` and `/api/queue` to surface backlog warnings.
- `/dev/deforumation-qt`: JavaScript port of Deforumation QT for real-time Deforum parameter steering.

## Development Notes
- Auth-protected routes use `meta.requiresAuth`; unauthenticated users are redirected to `/login`.
- Auth pages (`/login`, `/signup`, password reset) are guarded with `meta.handleAuth` to redirect authenticated users to the library.
- PrimeVue components and directives are registered globally in `src/main.js` so they are available throughout the app.
- When using the audio streaming page (`/soundscape`), ensure the backend helper and ComfyUI workflow defined in `backend/audio-workflow.json` are running.

## Contributing
Feel free to open issues or pull requests with bug fixes or enhancements. Please keep new components consistent with the existing PrimeVue/PrimeFlex patterns and prefer the services in `src/services` when talking to the API.
